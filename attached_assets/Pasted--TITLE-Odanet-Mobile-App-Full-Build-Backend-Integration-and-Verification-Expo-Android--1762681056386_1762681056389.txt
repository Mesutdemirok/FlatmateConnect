
â¸»


ğŸ§© TITLE:
Odanet Mobile App â€” Full Build, Backend Integration, and Verification (Expo Android)

ğŸ¯ GOAL:
Ensure the Odanet Expo Mobile App connects perfectly to the live backend at https://www.odanet.com.tr/api, fix the Auth and Listings logic, repair layout for Android safe area, verify everything through live testing in Expo Go, and prepare for final EAS Android production build.

---

## ğŸ”§ STEP 1 â€” CLEAN PROJECT STRUCTURE
1. Use this directory: `/workspace/odanet-mobile/`
2. Confirm folders exist:

app/
hooks/
lib/
theme/
assets/

3. Remove any duplicate nested â€œodanet-mobile/odanet-mobileâ€ folder.
4. Ensure all imports are **relative**, e.g.:
```ts
import { useAuth } from "../../hooks/useAuth";
import { api } from "../../lib/api";


â¸»

ğŸ§  STEP 2 â€” REBUILD AUTH SYSTEM

Replace /hooks/useAuth.ts with:

import { useState, useEffect } from "react";
import { useQueryClient } from "@tanstack/react-query";
import { api } from "../lib/api";
import * as SecureStore from "expo-secure-store";

interface User {
  id: string;
  email: string;
  firstName: string;
  lastName: string;
  profileImageUrl?: string;
}

interface LoginCredentials {
  email: string;
  password: string;
}

interface RegisterData extends LoginCredentials {
  firstName: string;
  lastName: string;
}

export function useAuth() {
  const [user, setUser] = useState<User | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const queryClient = useQueryClient();

  useEffect(() => {
    const loadUser = async () => {
      try {
        const token = await SecureStore.getItemAsync("auth_token");
        if (token) {
          api.defaults.headers.Authorization = `Bearer ${token}`;
          const { data } = await api.get<User>("/auth/me");
          setUser(data);
        }
      } catch (err) {
        console.log("Error loading user:", err.message);
      } finally {
        setIsLoading(false);
      }
    };
    loadUser();
  }, []);

  const login = async (credentials: LoginCredentials) => {
    setIsLoading(true);
    try {
      const { data } = await api.post("/auth/login", credentials);
      if (data.token) {
        await SecureStore.setItemAsync("auth_token", data.token);
        api.defaults.headers.Authorization = `Bearer ${data.token}`;
        const me = await api.get<User>("/auth/me");
        setUser(me.data);
      }
      queryClient.invalidateQueries({ queryKey: ["listings"] });
    } finally {
      setIsLoading(false);
    }
  };

  const register = async (userData: RegisterData) => {
    setIsLoading(true);
    try {
      const { data } = await api.post("/auth/register", userData);
      if (data.token) {
        await SecureStore.setItemAsync("auth_token", data.token);
        api.defaults.headers.Authorization = `Bearer ${data.token}`;
        const me = await api.get<User>("/auth/me");
        setUser(me.data);
      }
      queryClient.invalidateQueries({ queryKey: ["listings"] });
    } finally {
      setIsLoading(false);
    }
  };

  const logout = async () => {
    try {
      await api.post("/auth/logout");
    } catch {}
    await SecureStore.deleteItemAsync("auth_token");
    setUser(null);
    queryClient.clear();
  };

  return { user, isLoading, login, register, logout };
}

âœ… Fixes: â€œuseAuth is not a functionâ€
âœ… Loads /auth/me automatically
âœ… Restores full session flow

â¸»

ğŸ§© STEP 3 â€” FIX LAYOUT (BOTTOM TAB + SAFE AREA)

Replace /app/(tabs)/_layout.tsx with:

import { Tabs } from "expo-router";
import { SafeAreaView } from "react-native-safe-area-context";

export default function TabLayout() {
  return (
    <SafeAreaView style={{ flex: 1, backgroundColor: "#fff" }}>
      <Tabs
        screenOptions={{
          headerShown: false,
          tabBarActiveTintColor: "#7F00FF",
          tabBarInactiveTintColor: "#666",
          tabBarStyle: {
            backgroundColor: "#fff",
            paddingBottom: 8,
            height: 65,
          },
        }}
      />
    </SafeAreaView>
  );
}

âœ… Prevents bottom bar hiding behind Android navigation
âœ… Matches the purple-gradient web design aesthetic

â¸»

ğŸŒ STEP 4 â€” VERIFY API CONNECTION

Edit /lib/api.ts to include:

console.log("ğŸš€ Odanet API Connected:", api.defaults.baseURL);

Then confirm in the terminal after running npx expo start:

ğŸš€ Odanet API Connected: https://www.odanet.com.tr/api


â¸»

ğŸ§ª STEP 5 â€” AUTOMATIC VERIFICATION SEQUENCE

Run the following tests automatically:

1ï¸âƒ£ Start Metro:

npx expo start -c

2ï¸âƒ£ On Android (Expo Go):
	â€¢	Login with a valid account
	â€¢	Open â€œProfileâ€ tab (should NOT crash)
	â€¢	Navigate to â€œMessagesâ€ (no error)
	â€¢	Check that â€œGÃ¼ncel Ä°lanlarâ€ loads real data from /listings
3ï¸âƒ£ If â€œHata oluÅŸtuâ€ appears, print full JSON:

console.log("LISTING FETCH ERROR:", err.response?.data || err.message);

4ï¸âƒ£ Verify:
	â€¢	âœ… API Base: https://www.odanet.com.tr/api
	â€¢	âœ… Auth Token Stored
	â€¢	âœ… /auth/me returns valid user
	â€¢	âœ… Listings load successfully
	â€¢	âœ… Bottom tabs visible and clickable

Print success summary:

ğŸ‰ Odanet Mobile API Verified
âœ… Auth working
âœ… Listings loaded
âœ… SafeArea fixed
âœ… Ready for Android build


â¸»

ğŸ“¦ STEP 6 â€” ANDROID PRODUCTION BUILD (SKIP iOS)

Since Expo Android is active and iOS failed:

Run:

eas build -p android --profile production

Then verify build success at:
ğŸ‘‰ https://expo.dev/accounts/mesudemirok/projects/odanet-mobile/builds

â¸»

âš™ï¸ AGENT TO ENSURE
	â€¢	All imports reference real hook locations (no _hooksUseAuth)
	â€¢	SecureStore is active and token is retrieved properly
	â€¢	Layout changes propagate to Android Expo Go
	â€¢	Console outputs match expected âœ… messages
	â€¢	Build process only targets Android (ignore iOS)

â¸»

âœ… SUCCESS CHECKLIST
	â€¢	â€œuseAuth is not a functionâ€ â†’ fixed
	â€¢	â€œHata oluÅŸtuâ€ â†’ fixed
	â€¢	Profile & Messages â†’ open cleanly
	â€¢	Android tabs visible â†’ fixed
	â€¢	/listings data fetched â†’ working
	â€¢	â€œğŸš€ Odanet API Connectedâ€ appears in console
	â€¢	Build â†’ passes for Android production

ğŸ¯ OUTPUT MESSAGE:

ğŸ‰ Odanet Mobile App Fully Verified.
Ready for Google Play Console Beta Upload.

---
