
â¸»

ğŸ§  CREEPID AGENT PROMPT â€” Full Sync & Detail Page Fix (Web + Mobile)

Prompt Title: Repair Odanet Unified Data Flow â€” Fix Listing & Seeker Display (Web + Expo Mobile)

â¸»

Context Summary

We are working on Odanet, a room rental and roommate-finding platform.
Currently, the system is partly functional but misaligned between backend, website, and Expo mobile app.

Current State
	1.	âœ… API /api/users/seekers responds correctly and returns JSON data.
	2.	âš ï¸ In the Expo app, seeker cards appear but their profile images are missing.
	3.	âŒ Room listing detail pages in the mobile app open but only show â€œÄ°lan Sahibi / Ä°lan Sahibine UlaÅŸâ€ â€” no title, price, or description.
	4.	âŒ On the website, when clicking any listing or seeker, it says â€œÄ°lan BulunamadÄ±â€ for both types (broken slug or ID routing).
	5.	âš ï¸ config.ts may have been deleted earlier and needs to be fully restored and referenced properly by both the mobile and web projects.

â¸»

ğŸ¯ Mission

The goal is to restore full cross-platform functionality:
	â€¢	Seekers and listings both load correctly with images.
	â€¢	Detail pages (on both web and mobile) display full information.
	â€¢	Click actions route properly by slug or ID.
	â€¢	The config.ts file is restored and used consistently by all components.

â¸»

ğŸ§© Tasks to Execute

1. Restore and Standardize Config
	â€¢	Create a single /workspace/config.ts file with:

export const API_URL =
  process.env.NODE_ENV === "production"
    ? "https://www.odanet.com.tr"
    : "http://localhost:5000";


	â€¢	Update all mobile hooks (useSeekers.ts, useListings.ts, etc.) to:

import { API_URL } from "../../config";


	â€¢	Ensure backend references this same base URL when generating full image paths.

â¸»

2. Fix SeekerCard Image Rendering (Mobile)
	â€¢	In /odanet-mobile/components/SeekerCard.tsx, update:

<Image
  source={{ uri: `${API_URL}${seeker.profilePhotoUrl}` }}
  style={styles.image}
  resizeMode="cover"
/>

and add a graceful fallback:

{!seeker.profilePhotoUrl && (
  <Ionicons name="person-circle-outline" size={48} color="#ccc" />
)}


	â€¢	Confirm that profilePhotoUrl in the seeker API includes /uploads/seekers/... path (if not, update backend response to include it).

â¸»

3. Fix Room Listing Detail Page (Mobile)
	â€¢	In /odanet-mobile/app/listing/[id].tsx:
	â€¢	Fetch listing data from:

`${API_URL}/api/listings/${id}`


	â€¢	Display:
	â€¢	Title
	â€¢	Address
	â€¢	Rent amount
	â€¢	Description (about)
	â€¢	Image carousel (listing.images)
	â€¢	Add safe checks for missing data and show placeholders if fields are null.

â¸»

4. Fix Website â€œÄ°lan BulunamadÄ±â€ Issue
	â€¢	Check backend routes inside registerRoutes in server/routes.ts:

app.get("/api/listings/slug/:slug", async (req, res) => { ... });
app.get("/api/seekers/slug/:slug", async (req, res) => { ... });


	â€¢	Ensure both routes:
	â€¢	Query correct DB table (getListingBySlug, getSeekerProfileBySlug)
	â€¢	Return JSON data with slug, title, about, rentAmount, and profilePhotoUrl
	â€¢	Do not conflict with /api/users/:userId
	â€¢	On the frontend:
	â€¢	Verify dynamic page paths /oda-ilani/[slug] and /oda-arayan/[slug] fetch the correct endpoint.
	â€¢	If slug is missing, fallback to /api/listings/:id or /api/seekers/:id.

â¸»

5. Fix Database Query Filters
	â€¢	Update storage.getSeekerProfiles() and storage.getListings() so they always return:

{ isActive: true, isPublished: true }


	â€¢	Ensure both include related user data and images.

â¸»

6. Final Sync & Testing
Run the following to fully reload all environments:

# Restart backend
npm run dev

# Restart Expo mobile
cd odanet-mobile && npx expo start --tunnel --clear

Verify:
	â€¢	âœ… Mobile home feed shows both seekers + listings with images
	â€¢	âœ… Detail pages load full info (title, rent, image, about text)
	â€¢	âœ… Website pages /oda-ilani/[slug] and /oda-arayan/[slug] display correctly
	â€¢	âœ… Console shows:

âœ… Seekers fetched: X | âœ… Listings fetched: Y
âœ… Detail page loaded successfully



â¸»

âœ… End Result

After this repair:
	â€¢	Both mobile and website display room listings + room seekers with images and details.
	â€¢	Clicking any card opens a fully populated detail page.
	â€¢	All API endpoints and routes are consistent (/api/listings, /api/seekers, /api/users/seekers).
	â€¢	The config.ts file is restored and synchronized across all environments.

