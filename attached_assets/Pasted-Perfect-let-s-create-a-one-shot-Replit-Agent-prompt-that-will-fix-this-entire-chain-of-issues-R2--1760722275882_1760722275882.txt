Perfect ‚Äî let‚Äôs create a one-shot Replit Agent prompt that will fix this entire chain of issues (R2, database sync, Internal Server Error, image visibility, and old content).

Please copy and paste the full text below into your Replit Agent chat ‚¨áÔ∏è

‚∏ª

üß† PROMPT FOR REPLIT AGENT

TASK: Full Repair and Sync of Production (www.odanet.com.tr)

We are getting Internal Server Error and missing images on production (www.odanet.com.tr).
Preview (.replit.dev) works correctly.

I need you to fix everything end-to-end so the production deployment becomes clean, synced, and stable.

‚∏ª

üéØ Main Goals
	1.	Fix Internal Server Error
	‚Ä¢	Inspect server/index.ts, routes.ts, and any upload/migration logic.
	‚Ä¢	Identify and fix any unhandled exceptions or missing env vars causing 500 errors.
	‚Ä¢	Verify /uploads/health.txt returns ok.
	2.	Unify Database
	‚Ä¢	Ensure production deployment uses the same database as preview.
	‚Ä¢	Set DATABASE_URL = postgresql://neondb_owner:npg_TDnQNKk3Mjp4@ep-odd-scene-af56kk3x.c-2.us-west-2.aws.neon.tech/neondb?sslmode=require.
	‚Ä¢	Remove any old or duplicate Neon connection (like the ‚Äúgreen-term‚Äù one).
	‚Ä¢	Test listing retrieval via API.
	3.	Fix Cloudflare R2 Configuration
	‚Ä¢	Ensure these environment variables are identical between preview and production:

R2_ACCESS_KEY_ID = 80c4487a1a838befad9af96d720ec41b
R2_SECRET_ACCESS_KEY = a59f4f71379c7fd225f8a6725ac61ba3e3a71c714b757b49f722ad334640bf13
R2_BUCKET_NAME = odanet-uploads
R2_ACCOUNT_ID = 6f97940e30aab3a7db85052337e4536e
R2_PUBLIC_URL = https://pub-f084c4d11d4541f2a83f290d3f7f761e.r2.dev
R2_S3_ENDPOINT = https://6f97940e30aab3a7db85052337e4536e.r2.cloudflarestorage.com
VITE_R2_PUBLIC_URL = https://pub-f084c4d11d4541f2a83f290d3f7f761e.r2.dev


	‚Ä¢	Validate that the frontend build is reading VITE_R2_PUBLIC_URL during vite build.

	4.	Clean and Reset Data
	‚Ä¢	Remove all listings, seeker profiles, and images from both database and R2 bucket.
	‚Ä¢	Keep only user accounts intact.
	‚Ä¢	Upload one test listing with a safe image (e.g., from Unsplash/Pexels) to confirm system works.
	5.	Republish Correctly
	‚Ä¢	Ensure production .replit deployment uses:

Build: npm run build
Run: npm run start


	‚Ä¢	Verify NODE_ENV=production.
	‚Ä¢	Republish to www.odanet.com.tr.

	6.	Verification Checklist
	‚Ä¢	‚úÖ https://www.odanet.com.tr/uploads/health.txt returns ‚Äúok‚Äù.
	‚Ä¢	‚úÖ https://www.odanet.com.tr/oda-ilanlari loads without Internal Server Error.
	‚Ä¢	‚úÖ One test image appears correctly from R2.
	‚Ä¢	‚úÖ Database content matches preview.

‚∏ª

‚öôÔ∏è Notes
	‚Ä¢	Please check for any duplicate environment variables that might override R2 or DATABASE_URL.
	‚Ä¢	If needed, rebuild the frontend so that image URLs point to VITE_R2_PUBLIC_URL.
	‚Ä¢	If caching is an issue, purge Cloudflare cache after deployment.
	‚Ä¢	Report each fix step-by-step with verification logs.

‚∏ª

üßæ Expected Final State

‚úÖ www.odanet.com.tr live and identical to preview
‚úÖ All images load correctly from Cloudflare R2
‚úÖ No Internal Server Error
‚úÖ One verified test listing visible
‚úÖ Database fully synced

‚∏ª

Would you like me to prepare a second optional follow-up prompt ‚Äî just for verification and cleanup confirmation after the agent finishes this main fix?