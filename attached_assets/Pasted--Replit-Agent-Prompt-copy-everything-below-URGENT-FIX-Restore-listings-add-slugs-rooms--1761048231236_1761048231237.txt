
‚∏ª

üìå Replit Agent Prompt (copy everything below)

URGENT FIX ‚Äì Restore listings, add slugs (rooms + seekers), and sync live deploy

We have three issues to resolve now:
	1.	Room listings disappeared from the homepage after earlier changes.
	2.	URLs are not SEO-friendly for both rooms and seekers (e.g., /oda-ilani/002bd24b... and /oda-arayan/bc297816...).
	3.	Live domain https://www.odanet.com.tr is not in sync with the Replit Preview build.

Please implement the following tasks end-to-end:

‚∏ª

1) Restore listings on homepage
	‚Ä¢	Verify /api/listings returns an array of room listings without auth and without relying on slug.
	‚Ä¢	Verify the frontend components (especially client/src/components/FeaturedListings.tsx and any feeds like MixedFeed.tsx) map over the array and render cards.
	‚Ä¢	If the API changed, revert or adapt the query so:

useQuery({
  queryKey: ['/api/listings'],
  queryFn: async () => (await fetch('/api/listings')).json(),
})


	‚Ä¢	Ensure each listing returns at least: id, title, city, district, rentAmount, images, and (after this task) slug.

Acceptance: listings show again on the homepage.

‚∏ª

2) Slug system for Rooms AND Seekers

2.1 Add a shared slug util

Create shared/slug.ts:

import slugify from 'slugify';
import { customAlphabet } from 'nanoid';

const nano = customAlphabet('abcdefghijklmnopqrstuvwxyz0123456789', 6);

export function makeSlug(parts: Array<string | undefined | null>) {
  const base = parts
    .filter(Boolean)
    .map((p) =>
      slugify(String(p), {
        lower: true,
        strict: true, // remove punctuation
        locale: 'tr',
        trim: true,
      })
    )
    .filter(Boolean)
    .join('-')
    .replace(/-+/g, '-'); // collapse dashes

  return `${base}-${nano()}`; // ensures uniqueness
}

Install deps if missing:

npm i slugify nanoid

2.2 Rooms (ilanlar)
	‚Ä¢	On create (and when missing on existing doc), set listing.slug = makeSlug([listing.title, listing.district, listing.city]).
	‚Ä¢	Add endpoint:

GET /api/listings/slug/:slug  -> returns single listing by slug


	‚Ä¢	Keep legacy route working:

GET /api/listings/:id -> still returns listing by id


	‚Ä¢	In the server, add a 301 redirect endpoint for old URLs:

GET /oda-ilani/:id
  -> lookup by id, if found: 301 redirect to /oda-ilani/:slug
  -> if not found: 404


	‚Ä¢	In the frontend, update navigation:
	‚Ä¢	FeaturedListings.tsx: onClick ‚Üí navigate(\/oda-ilani/${listing.slug}`)`
	‚Ä¢	Any card/components that link to a room listing should use slug.
	‚Ä¢	Update room detail route (Wouter):
	‚Ä¢	Add route for /oda-ilani/:slug that fetches via /api/listings/slug/:slug.
	‚Ä¢	Optionally keep a fallback route /oda-ilani/:id that fetches by id and pushes to the slug URL once loaded.

Slug example (rooms):
/oda-ilani/nisantasi-ferah-daire-istanbul-k3f9a2

2.3 Seekers (oda arayanlar)
	‚Ä¢	Add a slug field to seekers on create:
seeker.slug = makeSlug([seeker.firstName, seeker.district, seeker.city])
	‚Ä¢	Add endpoint:

GET /api/seekers/slug/:slug  -> returns single seeker by slug


	‚Ä¢	Keep legacy route working:

GET /api/seekers/:id -> still returns seeker by id


	‚Ä¢	Add 301 redirect for old path:

GET /oda-arayan/:id
  -> lookup by id, redirect 301 to /oda-arayan/:slug


	‚Ä¢	In the frontend (e.g., SeekerCard.tsx), navigate to /oda-arayan/${seeker.slug} and update the detail page to fetch via the slug endpoint.

Slug example (seekers):
/oda-arayan/zeynep-nessantasi-istanbul-a1b2c3

Note: use Turkish locale in slugify. Replace accidental ‚Äúƒ±/ƒ∞/≈ü/ƒü/√∂/√º/√ß‚Äù properly via slugify with locale: 'tr'.

‚∏ª

3) Keep everything backwards-compatible
	‚Ä¢	DO NOT break existing ID URLs.
	‚Ä¢	Ensure any /oda-ilani/:id or /oda-arayan/:id still works by redirecting to the new slug route.
	‚Ä¢	Existing saved links won‚Äôt break.

‚∏ª

4) Frontend routing updates (Wouter)
	‚Ä¢	Add routes:
	‚Ä¢	/oda-ilani/:slug
	‚Ä¢	/oda-arayan/:slug
	‚Ä¢	If there are old ID routes still present, make them redirect to the slug route after fetching.
	‚Ä¢	Update any internal links (cards, lists) to build URLs with slug.

Files likely to touch:
	‚Ä¢	client/src/components/FeaturedListings.tsx
	‚Ä¢	client/src/components/ListingCard.tsx (if exists)
	‚Ä¢	client/src/components/SeekerCard.tsx
	‚Ä¢	client/src/pages/* or wherever Wouter routes are declared (often App.tsx/main.tsx)

‚∏ª

5) Deployment sync (Preview == Production)
	‚Ä¢	Confirm Vite base is correct (vite.config.ts should use base: '/').
	‚Ä¢	Ensure .replit and the Run command build and serve the same app to production.
	‚Ä¢	Rebuild and redeploy production:

npm run build


	‚Ä¢	Verify https://www.odanet.com.tr serves the same HTML as Preview (check <head> metas and the new slug routes).
	‚Ä¢	If the live domain is pointing to an old deployment, re-link it to the current Replit deploy target.

‚∏ª

6) Quick verifications
	‚Ä¢	Homepage shows room listings again.
	‚Ä¢	A room card opens at /oda-ilani/<slug>.
	‚Ä¢	A seeker card opens at /oda-arayan/<slug>.
	‚Ä¢	Visiting old ID URLs issues a 301 to the new slug URL.
	‚Ä¢	Live site https://www.odanet.com.tr matches Preview.
	‚Ä¢	GA/OG/meta remain intact.

‚∏ª

7) (Optional, if quick) Sitemaps
	‚Ä¢	If time permits: update client/public/sitemap.xml generator to include both room and seeker slug URLs (not IDs).

‚∏ª

Goal:
‚úÖ Listings restored on homepage
‚úÖ Slugs for rooms + seekers
‚úÖ Backwards-compatible redirects
‚úÖ Live domain in sync with latest build

Please proceed and confirm when done with a short summary of changed files + tests performed.

‚∏ª
