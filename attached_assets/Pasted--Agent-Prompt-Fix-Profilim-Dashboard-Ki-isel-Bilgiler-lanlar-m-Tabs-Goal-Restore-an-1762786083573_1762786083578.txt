
â¸»

ğŸ§  Agent Prompt â€” Fix â€œProfilimâ€ Dashboard (KiÅŸisel Bilgiler + Ä°lanlarÄ±m Tabs)

Goal:
Restore and improve the profile dashboard functionality on both web and mobile for logged-in users, including:
	â€¢	Displaying userâ€™s listings (both â€œOda Ä°lanÄ±â€ and â€œOda Arama Ä°lanÄ±â€) under â€œÄ°lanlarÄ±mâ€.
	â€¢	Displaying editable personal information under â€œKiÅŸisel Bilgilerâ€.
	â€¢	Ensuring correct API integration with authentication.

â¸»

ğŸ”§ Files to Review / Update
	â€¢	Web frontend:
/frontend/src/app/profil/page.tsx or /client/pages/profile/index.tsx
Components under: /frontend/src/components/profile/
	â€¢	ProfileTabs.tsx
	â€¢	PersonalInfoForm.tsx
	â€¢	MyListingsSection.tsx
	â€¢	API:
/server/routes/users.ts
/server/routes/listings.ts
/server/routes/seekers.ts

â¸»

ğŸ§© 1) â€œKiÅŸisel Bilgilerâ€ Tab Fix

Problem: Data not loading or edit form missing.
Goal: Reconnect it to the authenticated user endpoint and re-enable editing.

âœ… Expected behavior
	â€¢	Fetch current user via /api/users/me
	â€¢	Show editable fields:
	â€¢	Ad / Soyad
	â€¢	E-posta
	â€¢	Telefon (optional)
	â€¢	Cinsiyet
	â€¢	YaÅŸ
	â€¢	Profil fotoÄŸrafÄ± (upload + preview)
	â€¢	Save via PATCH /api/users/update
	â€¢	Show toast: â€œâœ… Bilgileriniz baÅŸarÄ±yla gÃ¼ncellendi.â€

ğŸ”§ Example Code Outline

const { data: user, refetch } = useQuery(["me"], () => api.get("/users/me").then(r => r.data));

const mutation = useMutation((formData) => api.patch("/users/update", formData), {
  onSuccess: () => toast.success("Bilgileriniz baÅŸarÄ±yla gÃ¼ncellendi."),
});

return (
  <form onSubmit={handleSubmit(mutation.mutate)}>
    <Input name="firstName" label="Ad" defaultValue={user?.firstName} />
    <Input name="lastName" label="Soyad" defaultValue={user?.lastName} />
    <Input name="email" label="E-posta" defaultValue={user?.email} disabled />
    <Button type="submit">Kaydet</Button>
  </form>
);


â¸»

ğŸ  2) â€œÄ°lanlarÄ±mâ€ Tab Fix

Problem: â€œHenÃ¼z oda arama ilanÄ±nÄ±z yokâ€ appears even if listings exist.
Goal: Fetch both room and seeker listings by current user ID, display cards, and allow editing or deletion.

âœ… Expected behavior
	1.	Fetch:

GET /api/users/me/listings
GET /api/users/me/seekers


	2.	Display:
	â€¢	â€œOda Ä°lanlarÄ±mâ€ â†’ show listing cards (with edit & delete)
	â€¢	â€œOda Arama Ä°lanÄ±mâ€ â†’ show seeker profile card (if exists)
	3.	Actions:
	â€¢	âœï¸ Edit â†’ /oda-ilani/duzenle/:id
	â€¢	âŒ Delete â†’ confirmation â†’ DELETE /api/listings/:id
	â€¢	â• Add â†’ /oda-ilani-ver

ğŸ”§ Example structure

const { data: myListings } = useQuery(["myListings"], () =>
  api.get("/users/me/listings").then(r => r.data)
);
const { data: mySeeker } = useQuery(["mySeeker"], () =>
  api.get("/users/me/seekers").then(r => r.data[0])
);

return (
  <div className="myListingsSection">
    <h3>Oda Ä°lanlarÄ±m</h3>
    {myListings?.length ? (
      <ListingGrid listings={myListings} />
    ) : (
      <EmptyState
        text="HenÃ¼z oda ilanÄ±nÄ±z yok."
        actionLabel="Oda Ä°lanÄ± Ver"
        actionHref="/oda-ilani-ver"
      />
    )}

    <h3>Oda Arama Ä°lanÄ±m</h3>
    {mySeeker ? (
      <SeekerCard seeker={mySeeker} />
    ) : (
      <EmptyState
        text="HenÃ¼z oda arama ilanÄ±nÄ±z yok."
        actionLabel="Oda Arama Ä°lanÄ± Ver"
        actionHref="/oda-arama-ilani-ver"
      />
    )}
  </div>
);


â¸»

ğŸ” 3) API Endpoints (Backend Adjustments)

Ensure these routes are implemented and return correct data for logged-in users:

// users.ts
router.get("/me", jwtAuth, async (req, res) => {
  const user = await db.query.users.findFirst({
    where: eq(users.id, req.user.id),
    with: { listings: true, seekerProfiles: true },
  });
  res.json(user);
});

router.get("/me/listings", jwtAuth, async (req, res) => {
  const listings = await db.query.listings.findMany({
    where: eq(listings.userId, req.user.id),
    orderBy: (l, { desc }) => [desc(l.createdAt)],
  });
  res.json(listings);
});

router.get("/me/seekers", jwtAuth, async (req, res) => {
  const seekers = await db.query.seekerProfiles.findMany({
    where: eq(seekerProfiles.userId, req.user.id),
  });
  res.json(seekers);
});


â¸»

ğŸ¨ 4) Visuals & UI Polish
	â€¢	Keep Odanet purple gradient header consistent (linear-gradient(90deg, #6A1B9A, #8E24AA)).
	â€¢	Use rounded section boxes with subtle drop shadow.
	â€¢	Add tab animation (fade in/out when switching).
	â€¢	Show skeleton loaders during data fetch.

â¸»

âœ… Final Expected Outcome

After fix:
	â€¢	Clicking â€œKiÅŸisel Bilgilerâ€ shows editable profile form.
	â€¢	Clicking â€œÄ°lanlarÄ±mâ€ displays:
	â€¢	all listings (cards with edit/delete buttons)
	â€¢	seeker profile card (if created)
	â€¢	All API calls authenticated with JWT.
	â€¢	Mobile and web mirror each other.
	â€¢	No empty-state errors when data exists.

Success confirmation:

â€œâœ… Profil sayfasÄ± tam olarak Ã§alÄ±ÅŸÄ±r hale getirildi â€” kiÅŸisel bilgiler dÃ¼zenlenebiliyor, ilanlar gÃ¶rÃ¼ntÃ¼lenip dÃ¼zenlenebiliyor.â€

â¸»
